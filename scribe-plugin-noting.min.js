define("scribe-plugin-noting",[],function(){return function(e){return function(n){function t(){var n=document.createElement(C);n.className=N;var t=(new Date).getTime().toString();return n.setAttribute("data-edited-by",e),n.setAttribute("data-edited-date",t),n}function r(e){var n=t();return e.textContent=e.textContent,n.appendChild(e),n}function o(e){var n=t(),r=e.cloneNode(!0);return n.innerHTML=r.innerHTML,r.appendChild(n),r}function i(e){var n=document.createDocumentFragment(),t=e.childNodes;return t=Array.prototype.slice.call(t),t.forEach(function(e){var t;t=e.nodeType===Node.TEXT_NODE?r(e):o(e),n.appendChild(t)}),n}function a(e){var n=e.childNodes;n=Array.prototype.slice.call(n);var t=n.filter(function(e){return-1!==y.indexOf(e.nodeName)});return t.length>0}function c(e){return u(e,"scribe-marker")}function u(e,n){return e.classList?e.classList.contains(n):!1}function l(e){return e.tagName===h}function s(e,n){for(var t=e.childNodes,r=0;r<t.length;r++)s(t[r],n);n(e)}function d(e){var n=e.firstChild,t=e.parentNode;t.replaceChild(n,e)}function f(e){for(var n=0,t=e.length;t>n;n++){{e[n]}if(c(e[n]))return n}return-1}function p(e,n){var t=!1,r=!1,o=[];return s(e,function(e){r||(c(e)&&(t===!0?r=!0:t=!0),!r&&t&&n(e)&&o.push(e))}),o}function v(e,n){e.placeMarkers(),e.selectMarkers(!0);var t=n.commonAncestorContainer,i=p(t,function(e){return!c(e)&&-1===f(e.childNodes)});i.forEach(function(e){var n,t=e.parentNode,i=e.nextSibling;n=e.nodeType===Node.TEXT_NODE?r(e):o(e),i?t.insertBefore(n,i):t.appendChild(n)}),e.selectMarkers()}function g(e,n){e.placeMarkers(),e.selectMarkers(!0);var t=e.getContaining(function(e){return l(e)});if(!t){var r=p(n.commonAncestorContainer,function(e){return l(e)});t=r[0]}var o=t.parentNode;t.nextSibling?o=t.nextSibling.parentNode:t.previousSibling&&(o=t.previousSibling.parentNode);var i=document.createTextNode(t.innerHTML);o.replaceChild(i,t),e.selectMarkers()}function m(e,n){e.placeMarkers(),e.selectMarkers(!0);var t=n.commonAncestorContainer,r=p(t,function(e){return l(e)});r=Array.prototype.slice.call(r),r.forEach(function(e){d(e)}),e.selectMarkers()}var C="gu:note",h="GU:NOTE",N="note",y=["P","LI","UL"],k=new n.api.Command("insertHTML");k.execute=function(){var e=new n.api.Selection,t=e.range,r=t.cloneContents();if(!e.selection.isCollapsed)if(this.queryState())a(r)?m(e,t):g(e,t);else if(a(r))v(e,t);else{var o=i(r);t.deleteContents(),t.insertNode(o)}},k.queryState=function(){var e=new n.api.Selection,t=e.range.cloneContents().querySelectorAll(".note"),r=function(e){for(var n=0,t=e.length;t>n;n++)if(l(e[n]))return!0},o=!!e.getContaining(function(e){return l(e)});return o||r(t)},n.commands.note=k,n.el.addEventListener("keydown",function(e){if(121===e.keyCode||119===e.keyCode){e.preventDefault();var t=n.getCommand("note");t.execute()}})}}});//# sourceMappingURL=scribe-plugin-noting.min.js.map