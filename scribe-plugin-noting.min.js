define("scribe-plugin-noting",[],function(){return function(e){return function(n){function t(){var n=document.createElement(m);n.className=v;var t=(new Date).getTime().toString();return n.setAttribute("data-edited",e+" "+t),n}function r(e){var n=t();return n.appendChild(e),n}function o(e){var n=t(n),r=e.cloneNode(!0);return n.innerHTML=r.innerHTML,r.appendChild(n),r}function i(e,n){var t=document.createDocumentFragment(),i=e.childNodes;return i=Array.prototype.slice.call(i),i.forEach(function(e){var i;e&&(i=e.nodeType===Node.TEXT_NODE?r(e,n):o(e,n),t.appendChild(i))}),t}function a(e){for(var n=0,t=e.childNodes.length;t>n;n++)return-1!==g.indexOf(e.childNodes[n].nodeName)?!0:!1}function c(e){return(" "+e.className+" ").indexOf(" scribe-marker ")>-1}function l(e){return(" "+e.className+" ").indexOf(" note ")>-1}function u(e,n){for(var t=e.childNodes,r=0;r<t.length;r++)u(t[r],n);n(e)}function s(e){var n=e.firstChild,t=e.parentNode;t.replaceChild(n,e)}function d(e){for(var n=0,t=e.length;t>n;n++){{e[n]}if(c(e[n]))return n}return-1}function f(e,n){var t=!1,r=!1,o=[];return u(e,function(e){r!==!0&&(c(e)&&(t===!0?r=!0:t=!0),!r&&t&&n(e)&&o.push(e))}),o}function p(e,n){e.placeMarkers(),e.selectMarkers(!0);var t=n.commonAncestorContainer,i=f(t,function(e){return!c(e)&&-1===d(e.childNodes)});i.forEach(function(e){if(e){var n,t=e.parentNode,i=e.nextSibling;n=e.nodeType===Node.TEXT_NODE?r(e):o(e),i?t.insertBefore(n,i):t.appendChild(n)}}),e.selectMarkers()}var m="span",v="note",g=["P","LI","UL"],h=new n.api.Command("insertHTML");h.execute=function(){var e,t=new n.api.Selection,r=t.range;if("Range"===t.selection.type)if(this.queryState())if(a(r.cloneContents())){t.placeMarkers(),t.selectMarkers(!0),e=r.commonAncestorContainer;var o=f(e,function(e){return l(e)});o=Array.prototype.slice.call(o),o.forEach(function(e){s(e)}),t.selectMarkers()}else{t.placeMarkers(),t.selectMarkers(!0),e=r.commonAncestorContainer;var c=e.parentNode;e.nextSibling?c=e.nextSibling.parentNode:e.previousSibling&&(c=e.previousSibling.parentNode);var u=document.createTextNode(e.innerText);c.replaceChild(u,e),t.selectMarkers()}else if(a(r.cloneContents()))p(t,r);else{var d=i(r.cloneContents());r.deleteContents(),r.insertNode(d)}},h.queryState=function(){var e=new n.api.Selection,t=e.range.cloneContents().querySelectorAll(".note"),r=function(e){for(var n=0,t=e.length;t>n;n++)if(l(e[n]))return!0},o=!!e.getContaining(function(e){return l(e)});return o||r(t)},h.queryEnabled=function(){var e=new n.api.Selection,t=e.getContaining(function(e){return/^(H[1-6])$/.test(e.nodeName)});return n.api.CommandPatch.prototype.queryEnabled.apply(this,arguments)&&!t},n.commands.note=h,n.el.addEventListener("keydown",function(e){if(121===e.keyCode){{var t=n.getCommand("note"),r=new n.api.Selection;r.range}t.execute()}})}}});//# sourceMappingURL=scribe-plugin-noting.min.js.map