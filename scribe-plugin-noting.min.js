define("scribe-plugin-noting",[],function(){return function(e){return function(n){function t(){var n=document.createElement(h);n.className=y;var t=(new Date).getTime().toString();return n.setAttribute("data-edited-by",e),n.setAttribute("data-edited-date",t),n}function r(e){var n=t();return n.appendChild(e),n}function o(e){var n=t(),r=e.cloneNode(!0);return n.innerHTML=r.innerHTML,r.appendChild(n),r}function i(e){var n=document.createDocumentFragment(),t=e.childNodes;return t=Array.prototype.slice.call(t),t.forEach(function(e){var t;t=e.nodeType===Node.TEXT_NODE?r(e):o(e),n.appendChild(t)}),n}function a(e){var n=e.childNodes;n=Array.prototype.slice.call(n);var t=n.filter(function(e){return-1!==C.indexOf(e.nodeName)});return t.length>0}function c(e){return u(e,"scribe-marker")}function u(e,n){return e.classList?e.classList.contains(n):!1}function l(e){return u(e,"note")}function d(e,n){for(var t=e.childNodes,r=0;r<t.length;r++)d(t[r],n);n(e)}function s(e){var n=e.firstChild,t=e.parentNode;t.replaceChild(n,e)}function f(e){for(var n=0,t=e.length;t>n;n++){{e[n]}if(c(e[n]))return n}return-1}function p(e,n){var t=!1,r=!1,o=[];return d(e,function(e){r||(c(e)&&(t===!0?r=!0:t=!0),!r&&t&&n(e)&&o.push(e))}),o}function v(e,n){e.placeMarkers(),e.selectMarkers(!0);var t=n.commonAncestorContainer,i=p(t,function(e){return!c(e)&&-1===f(e.childNodes)});i.forEach(function(e){var n,t=e.parentNode,i=e.nextSibling;n=e.nodeType===Node.TEXT_NODE?r(e):o(e),i?t.insertBefore(n,i):t.appendChild(n)}),e.selectMarkers()}function m(e,n){e.placeMarkers(),e.selectMarkers(!0);var t=n.commonAncestorContainer,r=t.parentNode;t.nextSibling?r=t.nextSibling.parentNode:t.previousSibling&&(r=t.previousSibling.parentNode);var o=document.createTextNode(t.innerText);r.replaceChild(o,t),e.selectMarkers()}function g(e,n){e.placeMarkers(),e.selectMarkers(!0);var t=n.commonAncestorContainer,r=p(t,function(e){return l(e)});r=Array.prototype.slice.call(r),r.forEach(function(e){s(e)}),e.selectMarkers()}var h="gu-note",y="note",C=["P","LI","UL"],N=new n.api.Command("insertHTML");N.execute=function(){var e=new n.api.Selection,t=e.range,r=t.cloneContents();if("Range"===e.selection.type)if(this.queryState())a(r)?g(e,t):m(e,t);else if(a(r))v(e,t);else{var o=i(r);t.deleteContents(),t.insertNode(o)}},N.queryState=function(){var e=new n.api.Selection,t=e.range.cloneContents().querySelectorAll(".note"),r=function(e){for(var n=0,t=e.length;t>n;n++)if(l(e[n]))return!0},o=!!e.getContaining(function(e){return l(e)});return o||r(t)},N.queryEnabled=function(){var e=new n.api.Selection,t=e.getContaining(function(e){return/^(H[1-6])$/.test(e.nodeName)});return n.api.CommandPatch.prototype.queryEnabled.apply(this,arguments)&&!t},n.commands.note=N,n.el.addEventListener("keydown",function(e){if(121===e.keyCode||119===e.keyCode){{var t=n.getCommand("note"),r=new n.api.Selection;r.range}t.execute()}})}}});//# sourceMappingURL=scribe-plugin-noting.min.js.map